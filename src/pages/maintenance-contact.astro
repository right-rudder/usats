---
import BaseLayout from "../layouts/BaseLayout.astro";
import { IoPhonePortraitOutline, IoLocationOutline } from "react-icons/io5";
import { TfiEmail } from "react-icons/tfi";
import contact from "../data/contact";
import { COMPANY_NAME } from "../consts";
import Header from "../components/astro/Header.astro";
const { data } = contact;
const MAINTENANCE_CONTACT_FORM_WEBHOOK_URL = import.meta.env.MAINTENANCE_CONTACT_FORM_WEBHOOK_URL;


const headerData = {
  headerH1: "MAINTENANCE USATS",
  imagePath: "/src/assets/placeholder.webp",
  imageAlt: "",
};
---

<BaseLayout siteTitle={data.pageTitle} siteDescription={data.pageDescription} keywords={data.pageKeywords}>
  
  <Header data={headerData} />
  <section class="py-30 relative isolate bg-gradient-to-b from-primary-950 to-primary-800" id="contact-us">
    <div class="mx-auto grid max-w-7xl grid-cols-1 lg:grid-cols-2">
      <div class="relative px-6 pb-20 pt-24 sm:pt-32 lg:static lg:px-8 lg:py-48">
        <div class="mx-auto max-w-xl lg:mx-0 lg:max-w-lg">
          <h2 class="text-pretty text-4xl font-bold font-sans tracking-tight text-red-700 lg:text-6xl">Get in touch</h2>
          <p class="mt-6 text-lg/8 text-muted-400 font-parag">
            {data.description}
          </p>
          <dl class="mt-10 space-y-4 text-base/7 text-muted-400 font-bold font-sans2">
            <div class="flex gap-x-4">
              <dt class="flex-none">
                <IoLocationOutline  />
              </dt>
              <dd>
                <a class="hover:text-white hover:underline" href={data.locations[0].gMaps}>
                  {data.locations[0].address}<br />
                  {data.locations[0].city}, {data.locations[0].state} {data.locations[0].zip}
                </a>
              </dd>
            </div>
            <div class="flex gap-x-4">
              <dt class="flex-none">
                <IoPhonePortraitOutline />
              </dt>
              <dd>
                <a class="hover:text-white hover:underline" href={`tel:${data.locations[0].phone}`}>{data.locations[0].phone}</a>
              </dd>
            </div>
            <div class="flex gap-x-4">
              <dt class="flex-none">
                <TfiEmail />
              </dt>
              <dd>
                <a class="hover:text-white" href={`mailto:${data.email}`}>{data.email}</a>
              </dd>
            </div>
          </dl>
        </div>
      </div>
      <div class="px-12 py-32 bg-primary-900">
        <form id="contact-form" class="w-full text-white">
          <div class="mb-4">
            <label for="first-name" class="block font-semibold">First Name</label>
            <input type="text" id="first-name" name="first-name" autocomplete="given-name" class="w-full h-9 p-2 border text-muted-900 bg-white border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="last-name" class="block font-semibold">Last Name</label>
            <input type="text" id="last-name" name="last-name" autocomplete="family-name" class="w-full h-9 p-2 border text-muted-900 bg-white border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="phone" class="block font-semibold">Phone</label>
            <input type="text" id="phone" name="phone" autocomplete="tel" class="w-full h-9 p-2 border text-muted-900 bg-white border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="email" class="block font-semibold">Email</label>
            <input type="email" id="email" name="email" autocomplete="email" class="w-full h-9 p-2 border text-muted-900 bg-white border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="aircraft-make" class="block font-semibold">Aircraft Manufacturer</label>
            <input type="text" id="aircraft-make" name="aircraft-make" class="w-full h-9 p-2 border bg-white text-muted-900 border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="aircraft-model" class="block font-semibold">Aircraft Model</label>
            <input type="text" id="aircraft-model" name="aircraft-model" class="w-full h-9 p-2 border bg-white text-muted-900 border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="n-number" class="block font-semibold">Aircraft N-Number</label>
            <input type="text" id="n-number" name="n-number" class="w-full h-9 p-2 border bg-white text-muted-900 border-gray-400 rounded-sm focus:outline focus:ring focus:border-primary-600/50" required>
          </div>
          <div class="mb-4">
            <label for="message" class="block font-semibold">How can we help you?</label>
            <textarea required name="message" id="message" rows="4" class="w-full p-2 border bg-white text-muted-900 border-accent-800 rounded-sm focus:outline focus:ring focus:border-primary-600/50"></textarea>
          </div>
          <p class="hidden">
            <label>
              Don't fill this out if you're human:
              <input name="confirm-email">
            </label>
          </p>
          <div class="mb-4">
            <input type="checkbox" name="agree-data-collection" id="agree-data-collection" class="mr-2 size-5">
            <label for="agree-data-collection" class="text-muted-400 text-sm lg:text-base">
              I agree to <a href="/terms-of-service" class="font-semibold hover:underline" target="_blank">terms of service</a> & <a href="/privacy-policy" class="font-semibold hover:underline" target="_blank">privacy policy</a>. By providing my phone number, I agree to receive text messages from the business.
            </label>
          </div>
          <button id="submit-button" form="contact-form" disabled type="submit" class="mx-auto mt-8 btn-primary cursor-not-allowed bg-gray-400 hover:bg-gray-800 hover:text-white">
            Send Message
          </button>
        </form>
      </div>
    </div>

    
    <!-- Background Pattern -->
    <div class="absolute inset-0 -z-10 overflow-hidden">
      <svg
        class="absolute left-[max(50%,25rem)] top-0 h-[64rem] w-[128rem] -translate-x-1/2 stroke-black [mask-image:radial-gradient(64rem_64rem_at_top,white,transparent)]"
        aria-hidden="true"
      >
        <defs>
          <pattern
            id="e813992c-7d03-4cc4-a2bd-151760b470a0"
            width="200"
            height="200"
            x="50%"
            y="-1"
            patternUnits="userSpaceOnUse"
          >
            <path d="M100 200V.5M.5 .5H200" fill="none"></path>
          </pattern>
        </defs>
        <svg x="50%" y="-1" class="overflow-visible fill-primary-950">
          <path
            d="M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M-300.5 600h201v201h-201Z"
            stroke-width="0"></path>
        </svg>
        <rect
          width="100%"
          height="100%"
          stroke-width="0"
          fill="url(#e813992c-7d03-4cc4-a2bd-151760b470a0)"></rect>
      </svg>
    </div>
  </section>

</BaseLayout>


<script define:vars={{ MAINTENANCE_CONTACT_FORM_WEBHOOK_URL }}>
  const checkbox = document.getElementById("agree-data-collection");
  const submitButton = document.getElementById("submit-button");

  checkbox.addEventListener("change", function () {
    if (checkbox.checked) {
      submitButton.disabled = false;
      submitButton.classList.remove("cursor-not-allowed", "bg-gray-400", "hover:bg-gray-400");
    } else {
      submitButton.disabled = true;
      submitButton.classList.add("cursor-not-allowed", "bg-gray-400", "hover:bg-gray-400");
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    const contactForm = document.getElementById("contact-form");
    if (contactForm !== null) {
      contactForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const formData = new FormData(contactForm);
        const confirmEmailValue = formData.get("confirm-email");
        if (confirmEmailValue === "" || confirmEmailValue === null) {
          contactForm.action = MAINTENANCE_CONTACT_FORM_WEBHOOK_URL;
        }

        const urlSearchParams = new URLSearchParams();
        for (const pair of formData.entries()) {
          urlSearchParams.append(pair[0], pair[1]);
        }

        const xhr = new XMLHttpRequest();
        xhr.open("POST", contactForm.action);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.onload = function () {
          if (xhr.status === 200) {
            window.location.href = "/contact-us-confirmation";
          } else {
            console.error("Form submission failed:", xhr.statusText);
          }
        };
        xhr.onerror = function () {
          console.error("Network error occurred while submitting the form.");
        };
        xhr.send(urlSearchParams);
      });
    } else {
      console.error("Contact form not found.");
    }
  });
</script>

<script src="../scripts/emailValidation.js"></script>